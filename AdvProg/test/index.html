<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Text (client-only, no server)</title>
  <style>
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .wrap{max-width:720px;margin:32px auto;padding:0 16px}
    #gen{padding:8px 12px;font-size:14px}
    #out{margin-top:10px;padding:12px;min-height:80px;border:1px solid #ddd;border-radius:8px;white-space:pre-wrap;word-break:break-word}
  </style>
</head>
<body>
  <main class="wrap">
    <button id="gen">生成</button>
    <pre id="out">（ここに生成結果）</pre>
  </main>

  <script type="module">
    import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3';

    const btn = document.getElementById('gen');
    const out = document.getElementById('out');
    let generator = null;

    async function ensurePipe() {
      if (generator) return generator;
      env.allowRemoteModels = true;
      env.useBrowserCache = true;
      // 軽量で確実に動く英語モデル（まずは動作確認用）
      generator = await pipeline('text-generation', 'Xenova/distilgpt2');
      return generator;
    }

    async function generate() {
      btn.disabled = true;
      out.textContent = '初回はモデルを読み込み中…（数十MB）';
      try {
        const pipe = await ensurePipe();
        const prompt = 'Write one short motivational sentence about typing practice: ';
        const result = await pipe(prompt, { max_new_tokens: 40, temperature: 0.9 });
        out.textContent = (result?.[0]?.generated_text || '').trim() || '(空の応答)';
      } catch (e) {
        out.textContent = '生成に失敗しました: ' + (e?.message || e);
      } finally {
        btn.disabled = false;
      }
    }

    btn.addEventListener('click', generate);
  </script>
</body>
</html>
